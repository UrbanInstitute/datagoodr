<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="datagoodr">
<title>datagoodr-workflow • datagoodr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="datagoodr-workflow">
<meta property="og:description" content="datagoodr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">datagoodr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/datagoodr-workflow.html">datagoodr-workflow</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>datagoodr-workflow</h1>
            
      
      
      <div class="d-none name"><code>datagoodr-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">datagoodr</span><span class="op">)</span></span>
<span><span class="va">wd</span> <span class="op">&lt;-</span> <span class="st">"../working-example"</span> <span class="co">#this is the datagoodr/working-example folder</span></span></code></pre></div>
<p>The following code executes a working example of the datagoodR
workflow.</p>
<div class="section level2">
<h2 id="manual-steps">Manual Steps<a class="anchor" aria-label="anchor" href="#manual-steps"></a>
</h2>
<div class="section level3">
<h3 id="step-0-loadsave-data">Step 0: Load/Save Data<a class="anchor" aria-label="anchor" href="#step-0-loadsave-data"></a>
</h3>
<p>Load or save the data you wish to use. The <code>example.df</code>
data set is the same as the csv saved at
datagoodr/data-dev/DEMO-DATA-SMALL.csv.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"example.df"</span>, package <span class="op">=</span> <span class="st">"datagoodr"</span><span class="op">)</span></span>
<span><span class="co"># datafile is located at</span></span>
<span><span class="co"># system.file("example.df", package = "datagoodr")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-1-create-the-dgf">Step 1: Create the DGF<a class="anchor" aria-label="anchor" href="#step-1-create-the-dgf"></a>
</h3>
<p>This step inputs a data file then outputs the DGF as an excel and csv
file. These files can then be manually (or iteratively) updated until
they have all the information you want.</p>
<p>The goal of the DGF is to store the “minimum” amount of information
to render the research guide without needed to read the raw data into
the quarto document in step 3.</p>
<p>If we want to create a DGF with the default settings, we run the
following code.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create the DGF from just the data frame with no extra styling</span></span>
<span><span class="co"># this creates DGF-V1.csv and DGF-V1.xlsx</span></span>
<span><span class="fu"><a href="../reference/create_dgf.html">create_dgf</a></span><span class="op">(</span><span class="va">example.df</span>,</span>
<span>           file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"DGF-V1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Say we want to add some more detailed information to our DGF, such as
the descriptions of the variables, the factor levels, etc. We first
define the additional information we want to add. Then we create the DGF
with this information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"vname,dd_desc,data_type_convert,data_type_format\n</span></span>
<span><span class="st">  F9_00_ORG_NAME_L1,Organization name line 1,NA,NA\n</span></span>
<span><span class="st">  F0_00_ORG_CONTACT,Contact person (from IRS files),NA,NA\n</span></span>
<span><span class="st">  F9_00_ORG_ADDR_L1,Organization street address line 1,NA,NA\n</span></span>
<span><span class="st">  F9_00_ORG_ADDR_CITY,Organization city,NA,NA\n</span></span>
<span><span class="st">  EIN,EIN,as.character,as_EIN\n</span></span>
<span><span class="st">  SUBSECCD,IRS subsection code,NA,NA\n</span></span>
<span><span class="st">  BMF_ACTIV1,IRS Activity Code 1,as.factor,NA\n</span></span>
<span><span class="st">  NTMAJ12,NTEE major group (12),NA,NA\n</span></span>
<span><span class="st">  NTEE1,NTEE major group,NA,NA\n</span></span>
<span><span class="st">  NTEEFINAL,NA,as.factor,NA\n</span></span>
<span><span class="st">  NTEESRC,NA,NA,NA\n</span></span>
<span><span class="st">  DEDUCTCD,IRS Deductibility code,NA,NA\n</span></span>
<span><span class="st">  OUTREAS,Reason why out of scope,as.factor,NA\n</span></span>
<span><span class="st">  F9_05_UBIZ_IMCOME_OVER_LIMIT_X,\"Had unrelated business gross income of $1,000 or   more\",as.factor,NA\n</span></span>
<span><span class="st">  OUTNCCS,Out of Scope flag,as.factor,NA\n</span></span>
<span><span class="st">  COUNTY_FIPS,State + County FIPS code,NA,NA\n</span></span>
<span><span class="st">  CEO_CENSUSTRACT,Census tract,NA,NA\n</span></span>
<span><span class="st">  F9_00_TAX_PERIOD_END_DATE,Tax period end date,NA,as_yyyymm\n</span></span>
<span><span class="st">  F9_00_TAX_PERIOD_END_DATE_PY,Tax period end date - prior year,NA,as_yyyymm\n</span></span>
<span><span class="st">  F9_00_TAX_PERIOD_BEGIN_DATE,Tax period begin date,as.character,as_yyyymm\n</span></span>
<span><span class="st">  F9_00_TAX_ACCPER,Tax period end date,NA,as_mm\n</span></span>
<span><span class="st">  F9_08_REV_TOT_TOT,Total revenue - total,NA,NA\n</span></span>
<span><span class="st">  F9_10_ASSET_TOT_BOY,Total assets - beginning of year,NA,NA\n</span></span>
<span><span class="st">  F9_10_ASSET_TOT_EOY,Total assets - end of year,NA,NA\n</span></span>
<span><span class="st">  F9_10_NAFB_TOT_BOY,Net assets or fund balances - beginning of year,NA,NA\n</span></span>
<span><span class="st">  F9_09_EXP_TOT_TOT,Total functional expenses - total expenses,NA,NA\n</span></span>
<span><span class="st">  F9_01_EXP_TOT_PY,Total expenses - prior year,NA,NA\n"</span></span>
<span></span>
<span><span class="co"># cat(info)</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/create_dgf.html">create_dgf</a></span><span class="op">(</span><span class="va">example.df</span>,</span>
<span>           vdesc <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">dd_desc</span>,</span>
<span>           vconvert <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">data_type_convert</span>,</span>
<span>           vformat <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">data_type_format</span>,</span>
<span>           file <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"DGF-V2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-validate-the-dgf">Step 2: Validate the DGF<a class="anchor" aria-label="anchor" href="#step-2-validate-the-dgf"></a>
</h3>
<p>This step would include many of the DGF validation steps in the
R/02*.R files. This is not currently operational. The goal of this step
is to validate each column to make sure it is in a format that step 3
can handle.</p>
</div>
<div class="section level3">
<h3 id="step-3-render-the-rg">Step 3: Render the RG<a class="anchor" aria-label="anchor" href="#step-3-render-the-rg"></a>
</h3>
<p>This step inputs the DGF you made in step 1 (and validated in step 2)
then renders datagoodr/inst/qmd-templates/RG.qmd file. This file makes
the research guide in PDF and HTML file type in the current working
directory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># set the path to the most recent version of the DGF that you want to use</span></span>
<span><span class="co"># the path is relative to where the RG.qmd file is (sorry, this is mildly annoying)</span></span>
<span><span class="co"># so the correct file path for this example is...</span></span>
<span><span class="va">path_to_dgf</span> <span class="op">&lt;-</span><span class="st">"../working-example/DGF-V2.xlsx"</span></span>
<span></span>
<span></span>
<span><span class="co">## Then we render the quarto document (in the qmd-templates folder)</span></span>
<span><span class="fu">quarto</span><span class="fu">::</span><span class="fu"><a href="https://quarto-dev.github.io/quarto-r/reference/quarto_render.html" class="external-link">quarto_render</a></span><span class="op">(</span></span>
<span>  <span class="st">"qmd-templates/RG.qmd"</span>,</span>
<span>  execute_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dgf_file <span class="op">=</span> <span class="va">path_to_dgf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The rendered versions should be in qmd-templates/RG.html and qmd-templates/RG.pdf</span></span></code></pre></div>
<p>If you are only generating documentation for this data set one time,
you can stop here. Step 4 and 5 are for when you need to regularly
update the data, and thus regularly update the associated RG.</p>
</div>
<div class="section level3">
<h3 id="step-4-refresh-the-dgf">Step 4: Refresh the DGF<a class="anchor" aria-label="anchor" href="#step-4-refresh-the-dgf"></a>
</h3>
<p>When the data set is updated, this step is meant to compare the old
data set to the new one. If anything changed, the DGF should also
updated. This updating is designed to be done through the rg_hash column
of the DGF. The hashing allows us to check if a variable needs to up
updated in the DGF without actually verifying each individual entry.</p>
<p>In the new data set for each variable, generate the hash value. If
the new hash value matches the one in the rg_hash column of the old DGF,
no need to update that variable, great! If the new hash value does not
match the one in the rg_hash column of the old DGF, then that variable’s
rg_[preview/properties/stats/graphics/hash] need to be updated.</p>
</div>
<div class="section level3">
<h3 id="step-5-customize">Step 5: Customize<a class="anchor" aria-label="anchor" href="#step-5-customize"></a>
</h3>
<p>The R/05*.R functions are designed for customization of the RG. This
could be templates, div arrangements, fonts, colors, or “polishing”
functions for the variables (such as <code>dollarize</code> for monetary
values).</p>
</div>
</div>
<div class="section level2">
<h2 id="wrapper-funtion">Wrapper Funtion<a class="anchor" aria-label="anchor" href="#wrapper-funtion"></a>
</h2>
<p>We have built a wrapper function that creates a project folder, runs
Steps 1 and 3, and documents all actions in a log file. To use the
wrapper function, run the following code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datagoodr.html">datagoodr</a></span><span class="op">(</span></span>
<span>  wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># specify the directory you want the project output to be in</span></span>
<span>  folder.name <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># specify the project folder name, default is datagoodr-TODAYS-DATE</span></span>
<span>  <span class="va">location.data.raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"example.df"</span>, package <span class="op">=</span> <span class="st">"datagoodr"</span><span class="op">)</span>, <span class="co">#filepath of rawdata set</span></span>
<span>  create.dgf.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>use.df.types <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#list of parameters for DGF</span></span>
<span>                           guess.factors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           guess.dates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           vdesc <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">dd_desc</span>,</span>
<span>                           vconvert <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">data_type_convert</span>,</span>
<span>                           vformat <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">data_type_format</span><span class="op">)</span>,</span>
<span>  rg.name <span class="op">=</span> <span class="st">"test-research-guide"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Olivia Beck, Jesse Lecy, Urban Inistitue National Center for Charitable Statistics.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
